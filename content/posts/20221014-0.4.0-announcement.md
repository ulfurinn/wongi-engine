---
title: v0.4.0 announcement
categories: annoucement
---

v0.4.0 is a major rewrite of large parts of the library.

**This is a breaking release. Take special care to test your rules if you want to upgrade.**

_This is a pre-release annoucement. It will be updated as work gets completed._

<!--more-->

## Overlays

Overlays were intended to work as a layered filesystem, but in reality this only worked with assertions and positive matchers. They have now been completely rewritten to work with all existing matchers and track both assertions and retractions correctly.

**Breaking change**: only the current (top-most) overlay may be used for asserting and retracting facts. Doing this with a lower overlay will cause undefined behaviour. It may be implemented in a future release, or the restriction may become enforced if no good solution is found.

A lower overlay is again available for modification once the higher one goes out of scope.

## Timelines

**Breaking change**: the timeline functionality has been removed. It may return in a future release.

## Aggregates

_WIP: finalized API_

## Performance

_WIP: matchers with a lot of variables are now faster_

## Circular logic detection

_WIP: the detection of self-negating and self-sustaining rules is now more robust_

## Other known breaking changes

`Network#select` now returns an `Enumerable` instead of an `Array`.

Custom actions (`action { |token| â€¦ }` and other forms) should now extract and save bound variables if they need them instead of just keeping the token reference, because the tokens now get destroyed more eagerly.
